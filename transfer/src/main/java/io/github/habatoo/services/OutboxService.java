package io.github.habatoo.services;

/**
 * Сервис для реализации паттерна "Transactional Outbox".
 * Служит для гарантированной доставки событий во внешние системы (например, Kafka или RabbitMQ)
 * путем предварительного сохранения событий в локальной базе данных в рамках той же транзакции,
 * что и бизнес-изменения.
 */
public interface OutboxService {

    /**
     * Обрабатывает накопленные события из таблицы outbox.
     * <p>
     * Выполняет чтение необработанных записей, их публикацию в брокер сообщений
     * и последующее обновление статуса (или удаление).
     * <p>
     * Запуск осуществляется каждые 5 секунд. Использование {@code fixedDelay}
     * гарантирует, что между завершением текущей и началом следующей итерации
     * выдерживается пауза в 5 секунд, предотвращая наложение задач при высокой нагрузке.
     */
    void processOutboxEvents();

    /**
     * Выполняет регламентную очистку архивных записей outbox.
     * <p>
     * Удаляет из базы данных успешно обработанные события, срок хранения которых
     * превысил установленный лимит, для предотвращения избыточного роста таблиц.
     * <p>
     * Запускается автоматически раз в час (3 600 000 мс).
     */
    void cleanupOldRecords();
}
