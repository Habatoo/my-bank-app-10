# Микросервис переводов (Transfer)

Микросервис **Transfer** отвечает за логику межбанковских переводов между пользователями системы. Это критически важный узел, обеспечивающий атомарность операции: списание средств у одного клиента и одновременное зачисление другому.

### Основные функции:
* **Внутренние переводы:** Перевод средств по логину получателя.
* **Проверка лимитов и баланса:** Валидация возможности совершения транзакции перед началом операции.
* **Гарантия доставки:** Механизм контроля того, что деньги не "пропадут" между аккаунтами.

### API Endpoints
Сервис работает по протоколу REST и принимает запросы в формате JSON.

| Метод | Эндпоинт    | Описание | Ответы |
|:--- |:------------|:--- |:--- |
| **POST** | `/transfer` | Перевести средства другому пользователю | 200 OK / 400 (ошибки валидации) |

**Пример тела запроса (Request Body):**
```json
{
  "recipientLogin": "petrov_2000",
  "amount": 500.00
}
```

### Логика выполнения перевода:
* Идентификация: Получает логин отправителя из JWT-токена.
* Проверка: Обращается к сервису Accounts для проверки существования получателя и наличия достаточной суммы у отправителя.
* Транзакция: Вызывает обновление балансов в сервисе Accounts (списание у отправителя, зачисление получателю).
* Уведомление: При успехе отправляет детализированный запрос в сервис Notifications для оповещения обеих сторон.

### Интеграция и безопасность
* Безопасность: Проверка прав владения счетом через Keycloak. Пользователь может инициировать перевод только со своего аккаунта.
* Отказоустойчивость: Обработка ошибок в случае недоступности сервиса аккаунтов.
* Валидация: Проверка на "самоперевод" (запрет отправки денег самому себе) и корректность суммы.

### Разработка и запуск
Сборка только модуля Transfer локально:
```bash

./gradlew :transfer:bootJar
```

### Запуск тестов
Модуль содержит комплексные тесты сценариев перевода, включая проверку граничных случаев (нулевой баланс, несуществующий получатель):
```bash

./gradlew :transfer:test
```
<hr>

[Вернуться к главному README](../README.md)