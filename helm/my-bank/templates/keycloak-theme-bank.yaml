# keycloak-theme-bank.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: keycloak-theme-bank
  namespace: dev
data:
  theme.properties: |
    parent=keycloak
    import=common/keycloak
    styles=css/style.css

  login.ftl: |
    <#import "template.ftl" as layout>
    <!DOCTYPE html>
    <html lang="ru">
    <head>
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="${url.resourcesPath}/css/style.css">
    <title>Chassis Bank | Вход</title>
    </head>
    <body>
    <div class="auth-card">
    <div class="text-center mb-4">
    <h3 class="fw-bold"><span class="text-primary">CHASSIS</span> BANK</h3>
    <p class="text-muted small">Добро пожаловать в безопасный банкинг</p>
    </div>
  
    <ul class="nav nav-pills nav-fill mb-4">
    <li class="nav-item">
    <a class="nav-link active" href="#">Вход</a>
    </li>
    <li class="nav-item">
    <a class="nav-link" href="${url.registrationUrl}">Регистрация</a>
    </li>
    </ul>
  
    <#-- Сообщения об ошибках от Keycloak -->
    <#if message?exists && message.type == 'error'>
    <div class="alert alert-error">${message.summary}</div>
    </#if>
  
    <form action="${url.loginAction}" method="post">
    <div class="mb-3">
    <label class="form-label small">Логин</label>
    <input type="text" class="form-control" name="username" id="username" autofocus autocomplete="off">
    </div>
    <div class="mb-4">
    <label class="form-label small">Пароль</label>
    <input type="password" class="form-control" name="password" id="password" autocomplete="off">
    </div>
    <button type="submit" class="btn btn-primary btn-auth">Войти в кабинет</button>
    </form>
    </div>
    </body>
    </html>

  register.ftl: |
    <#import "template.ftl" as layout>
   <html lang="ru">
    <!DOCTYPE html>
   <head>
   <meta charset="utf-8">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <link rel="stylesheet" href="${url.resourcesPath}/css/style.css">
   <title>Chassis Bank | Регистрация</title>
   </head>
   <body>
   <div class="auth-card">
   <div class="text-center mb-4">
   <h3 class="fw-bold"><span class="text-primary">CHASSIS</span> BANK</h3>
   <p class="text-muted small">Создание нового аккаунта</p>
   </div>
  
   <ul class="nav nav-pills nav-fill mb-4">
   <li class="nav-item">
   <a class="nav-link" href="${url.loginUrl}">Вход</a>
   </li>
   <li class="nav-item">
   <a class="nav-link active" href="#">Регистрация</a>
   </li>
   </ul>
  
   <#if message?exists && message.type == 'error'>
   <div class="alert alert-danger">${message.summary}</div>
   </#if>
  
   <form action="${url.registrationAction}" method="post">
   <#-- username нужен Keycloak для создания учетной записи -->
   <div class="mb-3">
   <label class="form-label small">Логин (используется для входа)</label>
   <input type="text" class="form-control" name="username" id="username" value="${(register.formData.username!'')}" placeholder="ivanov_ivan" required>
   </div>
  
   <#--firstName мапим на поле 'name' -->
   <div class="mb-3">
   <label class="form-label small">Полное имя</label>
   <input type="text" class="form-control" name="firstName" id="firstName" value="${(register.formData.firstName!'')}" placeholder="Иванов Иван" required>
   </div>
  
   <#-- lastName скрываем или используем как заглушку, так как в DTO его нет -->
   <input type="hidden" name="lastName" value="-">
  
   <div class="mb-3">
   <label class="form-label small">Email</label>
   <input type="email" class="form-control" name="email" id="email" value="${(register.formData.email!'')}" placeholder="example@mail.ru" required>
   </div>
  
   <#-- Дата рождения как кастомный атрибут -->
   <div class="mb-3">
   <label class="form-label small">Дата рождения</label>
   <input type="date" class="form-control" name="user.attributes.birthdate" id="birthdate" value="${(register.formData['user.attributes.birthdate']!'')}" required>
   </div>
  
   <div class="mb-3">
   <label class="form-label small">Пароль</label>
   <input type="password" class="form-control" name="password" id="password" placeholder="••••••••" required>
   </div>
  
   <div class="mb-3">
   <label class="form-label small">Подтвердите пароль</label>
   <input type="password" class="form-control" name="password-confirm" id="password-confirm" placeholder="••••••••" required>
   </div>
  
   <button type="submit" class="btn btn-primary btn-auth w-100">Создать аккаунт</button>
   </form>
   </div>
   </body>
   </html>

  style.css: |
    body { font-family: 'Inter', sans-serif; background-color: #0f172a; height: 100vh; display: flex; align-items: center; justify-content: center; }
    .auth-card { background: white; border-radius: 24px; padding: 2.5rem; width: 100%; max-width: 450px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
    .nav-pills .nav-link { border-radius: 12px; color: #64748b; font-weight: 500; border: none; background: none; }
    .nav-pills .nav-link.active { background-color: #2563eb; color: white; }
    .form-control { border-radius: 12px; padding: 0.8rem; background-color: #f8fafc; border: 1px solid #e2e8f0; margin-bottom: 1rem; }
    .btn-auth { border-radius: 12px; padding: 0.8rem; font-weight: 600; width: 100%; transition: 0.3s; border: none; }
    .btn-primary { background-color: #2563eb; color: white; }
    .text-primary { color: #2563eb !important; }
    .alert { padding: 0.75rem; border-radius: 12px; margin-bottom: 1rem; font-size: 0.875rem; }
    .alert-error { background-color: #fee2e2; color: #991b1b; }
