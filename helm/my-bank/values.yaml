account-db:
  postgres:
    db: account_db
    user: bank_admin
    password: bank_password
  persistence:
    size: 1Gi

cash-db:
  postgres:
    db: cash_db
    user: bank_admin
    password: bank_password
  persistence:
    size: 1Gi

notification-db:
  postgres:
    db: notification_db
    user: bank_admin
    password: bank_password
  persistence:
    size: 1Gi

transfer-db:
  postgres:
    db: transfer_db
    user: bank_admin
    password: bank_password
  persistence:
    size: 1Gi

global:
  db:
    user: "bank_admin"
    port: "5432"
  keycloak:
    url: "http://keycloak"
    port: "8080"
    realm: "bank"

keycloak:
  service:
    type: ClusterIP
    ports:
      http: 80
    targetPort: 8080

  postgresql:
    enabled: true
    image:
      registry: docker.io
      repository: bitnamilegacy/postgresql
      tag: "17.6.0-debian-12-r4"

  image:
    registry: docker.io
    repository: bitnamilegacy/keycloak
    tag: "26.3.3"

  fullnameOverride: keycloak

  auth:
    adminUser: admin
    adminPassword: admin

  extraEnvVars:
    - name: KC_BOOTSTRAP_ADMIN_USERNAME
      value: "admin"
    - name: KC_BOOTSTRAP_ADMIN_PASSWORD
      value: "admin"
    - name: KEYCLOAK_LOG_LEVEL
      value: "DEBUG"
    - name: KC_HEALTH_ENABLED
      value: "true"
    - name: KC_METRICS_ENABLED
      value: "true"
    - name: KC_HTTP_ENABLED
      value: "true"
    - name: KC_HOSTNAME_STRICT
      value: "false"
    - name: KC_HOSTNAME_STRICT_HTTPS
      value: "false"
    - name: KC_HOSTNAME_STRICT_BACKCHANNEL
      value: "false"
    - name: KC_PROXY_HEADERS
      value: "xforwarded"
    - name: KC_HOSTNAME
      value: "keycloak"
    - name: KC_IMPORT_STRATEGY
      value: "OVERWRITE_EXISTING"
    - name: KEYCLOAK_EXTRA_ARGS
      value: "--import-realm"
    - name: KC_HTTP_MANAGEMENT_PORT
      value: "9000"

  extraVolumes:
    - name: realm-import-raw
      configMap:
        name: keycloak-import
    - name: realm-import-writable
      emptyDir: { }
    - name: custom-theme-source
      configMap:
        name: keycloak-theme

  extraVolumeMounts:
    - name: realm-import-writable
      mountPath: /opt/bitnami/keycloak/data/import
    - name: custom-theme-source
      mountPath: /opt/bitnami/keycloak/themes/bank-theme/login/login.ftl
      subPath: login.ftl
    - name: custom-theme-source
      mountPath: /opt/bitnami/keycloak/themes/bank-theme/login/register.ftl
      subPath: register.ftl
    - name: custom-theme-source
      mountPath: /opt/bitnami/keycloak/themes/bank-theme/login/theme.properties
      subPath: theme.properties
    - name: custom-theme-source
      mountPath: /opt/bitnami/keycloak/themes/bank-theme/login/resources/css/style.css
      subPath: style.css

  initContainers:
    - name: prepare-realm
      image: busybox:1.36
      command: [ "/bin/sh", "-c" ]
      args:
        - |
          set -e
          echo "Copying realm files..."
          cp -v /cm/*.json /opt/bitnami/keycloak/data/import/ || echo "No json found"
      volumeMounts:
        - name: realm-import-raw
          mountPath: /cm
        - name: realm-import-writable
          mountPath: /opt/bitnami/keycloak/data/import

  persistence:
    deployPostgresql: true