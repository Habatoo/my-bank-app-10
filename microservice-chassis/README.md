# Shared Module: Microservice Chassis

**microservice-chassis** — это общая библиотека (shared library), содержащая переиспользуемый код, общие конфигурации и базовые компоненты, которые используются всеми микросервисами системы (`Account`, `Cash`, `Transfer`, `Notification`).

Использование шасси позволяет соблюдать принцип **DRY (Don't Repeat Yourself)** и обеспечивать единообразие поведения всех сервисов системы.

### Основное назначение:
* **Общие модели данных:** Базовые DTO (Data Transfer Objects), перечисления (Enums) и классы исключений.
* **Безопасность:** Базовые настройки Spring Security для работы с JWT и Keycloak.
* **Логирование и мониторинг:** Настроенные конфигурации для логирования и интеграции с системами мониторинга.
* **Тестовая инфраструктура:** Базовые классы для интеграционных тестов с использованием Testcontainers (PostgreSQL, Redis, Keycloak).

### Структура модуля:
* `src/main/java/.../base/` — общие сущности и константы.
* `src/main/java/.../configurations/` — общие бины (WebClient, ObjectMapper, Security).
* `src/main/java/.../dto/` — общие сущности.
* `src/main/java/.../handlers/` — глобальный обработчик ошибок (Global Exception Handler) и кастомные исключения.
* `src/main/java/.../logging/` — общие бины logging.
* `src/main/java/.../models/` — общие entity.
* `src/main/java/.../repositories/` — общие бины репозитория outbox.
* `src/test/java/.../` — абстрактные классы для тестов, которые наследуются остальными микросервисами.

### Ключевые компоненты:
1. **Global Error Handling:** Единый формат ответа при ошибках во всей системе (стандарт RFC 7807).
2. **Security Utils:** Утилитные методы для извлечения `login` или `roles` из `ReactiveSecurityContext`.
3. **WebClient Config:** Настроенный реактивный клиент с таймаутами и логированием запросов между сервисами.

### Использование в других модулях
Чтобы подключить шасси к новому микросервису, добавьте зависимость в `build.gradle` соответствующего модуля:

```gradle
dependencies {
    implementation project(':microservice-chassis')
}
```
### Разработка и сборка
Поскольку это библиотека, она не является запускаемым приложением (bootJar для неё отключен). 
Она собирается как обычный JAR-архив:
```bash

./gradlew :microservice-chassis:jar
```
### Особенности сборки в Docker
При сборке любого микросервиса через Dockerfile, папка microservice-chassis копируется целиком перед 
выполнением сборки, так как она является локальной зависимостью проекта.
<hr>