package io.github.habatoo.services;

/**
 * Сервис управления исходящими событиями (Transactional Outbox).
 * <p>
 * Обеспечивает гарантированную доставку сообщений и событий в сторонние системы
 * или брокеры сообщений. Реализует паттерн, позволяющий избежать распределенных транзакций
 * путем сохранения события в локальную БД в той же транзакции, что и бизнес-данные,
 * с последующей асинхронной обработкой.
 * </p>
 *
 */
public interface OutboxService {

    /**
     * Обработка накопившихся событий в таблице Outbox.
     * <p>
     * Метод выполняет опрос (polling) таблицы событий, инициирует их отправку
     * и обновляет статус доставки.
     * </p>
     * <p>
     * <b>Параметры запуска:</b> выполняется с фиксированной задержкой (fixedDelay).
     * Это гарантирует, что новая итерация обработки не начнется до тех пор,
     * пока не завершится текущая, что предотвращает наложение (overlap) процессов.
     * </p>
     */
    void processOutboxEvents();

    /**
     * Регулярная очистка архивных записей Outbox.
     * <p>
     * Удаляет из базы данных успешно обработанные события, срок хранения которых
     * превысил установленный лимит. Это необходимо для предотвращения чрезмерного
     * разрастания таблиц и поддержания высокой производительности индексов.
     * </p>
     * <p>
     * <b>Регламент:</b> по умолчанию запускается один раз в час (3 600 000 мс).
     * </p>
     */
    void cleanupOldRecords();
}
