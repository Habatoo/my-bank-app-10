# Микросервис обналичивания (Cash)

Микросервис **Cash** отвечает за финансовые операции пополнения и снятия виртуальных денежных средств со счета пользователя. Сервис обеспечивает целостность данных при работе с балансом и взаимодействует с системой уведомлений.

### Основные функции:
* **Пополнение счета (Deposit):** Внесение виртуальных денег на баланс авторизованного пользователя.
* **Снятие средств (Withdraw):** Списание денег со счета с обязательной проверкой достаточности баланса.
* **Валидация транзакций:** Проверка корректности сумм (запрет отрицательных значений) и прав доступа.

### API Endpoints
Сервис предоставляет REST-интерфейс для выполнения финансовых операций. Все запросы принимаются в формате JSON через API Gateway:

| Метод | Эндпоинт      | Описание | Ответы |
|:--- |:--------------|:--- |:--- |
| **POST** | `/cash/{PUT}` | Положить деньги на счет текущего пользователя | 200 OK / 400 Bad Request |
| **POST** | `/cash/{GET}` | Снять деньги со счета текущего пользователя | 200 OK / 400 (недост. средств) |

**Логика взаимодействия:**
1. Получает запрос от фронтенда с суммой операции.
2. Идентифицирует пользователя по логину из JWT-токена.
3. Обращается к сервису **Accounts** для изменения текущего баланса.
4. При успешном завершении отправляет REST-запрос в сервис **Notifications** для фиксации события.

### Интеграция и безопасность
* **Keycloak:** Доступ к операциям разрешен только авторизованным пользователям с валидным JWT.
* **Межсервисное взаимодействие:** Использует WebClient для синхронных запросов к микросервису Accounts.
* **Ошибки:** Если на счету недостаточно средств для снятия, сервис возвращает ошибку с описанием причины.

### Разработка и запуск
Сборка только модуля Cash локально:
```bash

./gradlew :cash:bootJar
```
### Запуск тестов
Модуль включает интеграционные тесты транзакций и контрактные проверки взаимодействия с Accounts:
```bash

./gradlew :cash:test
```
<hr>

[Вернуться к главному README](../README.md)