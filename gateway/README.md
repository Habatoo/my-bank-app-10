# Микросервис API Gateway

Микросервис **Gateway** является единой точкой входа (Entry Point) во всю систему. Он построен на базе **Spring Cloud Gateway** и отвечает за маршрутизацию трафика, обеспечение безопасности и агрегацию микросервисов под единым доменом.

### Основные функции:
* **Маршрутизация (Routing):** Перенаправление входящих запросов на соответствующие микросервисы (`Account`, `Cash`, `Transfer`, `Notification`) на основе пути в URL.
* **Централизованная аутентификация:** Проверка валидности JWT-токенов совместно с Keycloak.
* **Token Relay:** Автоматическая передача токена авторизации (Bearer Token) в заголовках запроса к нижележащим сервисам.

### Маршруты (Routes)
Gateway настраивает проксирование по следующим правилам:

| Префикс пути | Целевой микросервис | Описание |
|:--- |:--- |:--- |
| `/api/accounts/**` | `account-service` | Профиль и баланс пользователя |
| `/api/cash/**` | `cash-service` | Пополнение и снятие средств |
| `/api/transfer/**` | `transfer-service` | Денежные переводы |

### Интеграция и безопасность
* **Security Filter Chain:** Все запросы (кроме публичных эндпоинтов авторизации) проходят проверку через Spring Security.
* **CORS Configuration:** Настроены правила разрешенных источников для взаимодействия с фронтенд-частью.
* **Error Handling:** Единая обработка ошибок (например, если целевой сервис недоступен, Gateway возвращает 503 Service Unavailable).

### Технологический стек
* **Spring Cloud Gateway:** Реактивный шлюз на базе Project Reactor и Netty.
* **OAuth2 Resource Server:** Настройка для интеграции с Keycloak.

### Разработка и запуск
Сборка только модуля Gateway локально:
```bash

./gradlew :gateway:bootJar
```
### Настройка конфигурации
Основные настройки маршрутов и безопасности находятся в файле src/main/resources/application.yml.
При запуске в Docker переменные окружения для Gateway передаются через общий .env файл 
(параметры Keycloak Issuer URI, Client ID и секреты).

### Запуск тестов
Модуль содержит тесты маршрутизации и проверки работы фильтров безопасности:
```bash

./gradlew :gateway:test
```
<hr>

[Вернуться к главному README](../README.md)